<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

	<composite:interface>
		<composite:attribute name="targetBean" />
		<composite:attribute name="render" />
	</composite:interface>
	<composite:implementation>
		<div id="#{cc.clientId}">
			<h:outputScript>
	function doSelect(component){
	    var currentValue = component.getValue();
    	var items = component.items;
    	var item = jQuery(items).find("span[data-value='" +currentValue+"']");
    	var uuid = jQuery(item).attr('data-uuid');
    	submitUUID(uuid);
    	component.setValue("");
	}
	</h:outputScript>
			<h:panelGrid columns="3">
				<h:outputText value="#{msgs.group}" />
				<rich:autocomplete id="autocompleteGroupId"
					autocompleteMethod="#{groupsBean.groupsStartingWithPrefix}"
					var="group" layout="table"
					fetchValue="#{group.name} - #{group.owner.email}" mode="cachedAjax"
					minChars="4" autofill="true" required="true">
					<rich:column>
						<span data-value="#{group.name} - #{group.owner.email}"
							data-uuid="#{group.key}">#{group.name} -
							#{group.owner.email}</span>
					</rich:column>
				</rich:autocomplete>
				<a4j:commandButton value="#{msgs.commons_add}"
					onclick="doSelect(#{rich:component('autocompleteGroupId')});" />
			</h:panelGrid>
			<a4j:jsFunction name="submitUUID" action="#{shareFormBean.addGroup}"
				render="#{cc.attrs.render}">
				<a4j:param name="uuid" assignTo="#{shareFormBean.newGroup}" />
			</a4j:jsFunction>
		</div>
	</composite:implementation>

</ui:composition>